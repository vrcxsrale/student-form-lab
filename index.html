<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Student Form & Table</title>

<!-- Bootstrap 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    .minor {
        background-color: #fff3cd !important; /* Highlight minors */
    }
</style>

</head>
<body class="bg-light">

<div class="container mt-5">

    <h3 class="text-center mb-4">Interactive Student Form</h3>

    <!-- FORM -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <form id="studentForm">

                <div class="row g-3">
                    <div class="col-md-4">
                        <input type="text" id="lastName" class="form-control" placeholder="Last Name">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="firstName" class="form-control" placeholder="First Name">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="middleName" class="form-control" placeholder="Middle Name (Optional)">
                    </div>
                    <div class="col-md-4">
                        <input type="date" id="birthdate" class="form-control">
                    </div>
                    <div class="col-md-4">
                        <select id="course" class="form-select">
                            <option value="">Select Course</option>
                            <option>BSIT</option>
                            <option>BSCS</option>
                            <option>BSE</option>
                            <option>BSBA</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="yearLevel" class="form-control" placeholder="Year Level">
                    </div>
                </div>

                <div class="mt-3 text-end">
                    <button type="button" id="submitBtn" class="btn btn-primary" onclick="saveStudent()">
                        Add Student
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SEARCH + SORT -->
    <div class="row mb-3">
        <div class="col-md-6">
            <input type="text" id="search" class="form-control" placeholder="Search student..." onkeyup="displayStudents()">
        </div>
        <div class="col-md-6 text-end">
            <button class="btn btn-secondary" onclick="sortStudents()">Sort Alphabetically</button>
        </div>
    </div>

    <!-- TABLE -->
    <div class="table-responsive">
        <table class="table table-bordered table-hover text-center align-middle">
            <thead class="table-dark">
                <tr>
                    <th>#</th>
                    <th>Name</th>
                    <th>Age</th>
                    <th>Course</th>
                    <th>Year</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>

</div>

<script>
let students = JSON.parse(localStorage.getItem("students")) || [];
let editIndex = null;

// UTILITIES
function calculateAge(birthdate) {
    let birth = new Date(birthdate);
    let today = new Date();
    let age = today.getFullYear() - birth.getFullYear();
    let m = today.getMonth() - birth.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) age--;
    return age;
}

function saveToStorage() {
    localStorage.setItem("students", JSON.stringify(students));
}

// ADD / UPDATE
function saveStudent() {
    let lastName = lastNameEl().value.trim();
    let firstName = firstNameEl().value.trim();
    let middleName = middleNameEl().value.trim();
    let birthdate = birthdateEl().value;
    let course = courseEl().value;
    let yearLevel = yearLevelEl().value.trim();

    if (!lastName || !firstName || !birthdate || !course || !yearLevel) {
        alert("Please fill in all required fields.");
        return;
    }

    // PREVENT DUPLICATES
    let duplicate = students.some((s, i) =>
        s.lastName.toLowerCase() === lastName.toLowerCase() &&
        s.firstName.toLowerCase() === firstName.toLowerCase() &&
        i !== editIndex
    );

    if (duplicate) {
        alert("Duplicate student name is not allowed.");
        return;
    }

    let student = { lastName, firstName, middleName, birthdate, course, yearLevel };

    if (editIndex === null) {
        students.push(student);
    } else {
        students[editIndex] = student;
        editIndex = null;
        submitBtn().textContent = "Add Student";
        submitBtn().className = "btn btn-primary";
    }

    saveToStorage();
    document.getElementById("studentForm").reset();
    displayStudents();
}

// DISPLAY
function displayStudents() {
    let search = document.getElementById("search").value.toLowerCase();
    let table = document.getElementById("studentTable");
    table.innerHTML = "";

    students.forEach((s, index) => {
        let fullName = `${s.lastName} ${s.firstName} ${s.middleName}`.toLowerCase();
        if (!fullName.includes(search)) return;

        let age = calculateAge(s.birthdate);
        let rowClass = age < 18 ? "minor" : "";

        table.innerHTML += `
        <tr class="${rowClass}">
            <td>${index + 1}</td>
            <td>${s.lastName}, ${s.firstName} ${s.middleName}</td>
            <td>${age}</td>
            <td>${s.course}</td>
            <td>${s.yearLevel}</td>
            <td>
                <button class="btn btn-success btn-sm me-1" onclick="editStudent(${index})">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteStudent(${index})">Delete</button>
            </td>
        </tr>`;
    });
}

// SORT
function sortStudents() {
    students.sort((a, b) => a.lastName.localeCompare(b.lastName));
    saveToStorage();
    displayStudents();
}

// EDIT
function editStudent(index) {
    let s = students[index];
    editIndex = index;

    lastNameEl().value = s.lastName;
    firstNameEl().value = s.firstName;
    middleNameEl().value = s.middleName;
    birthdateEl().value = s.birthdate;
    courseEl().value = s.course;
    yearLevelEl().value = s.yearLevel;

    submitBtn().textContent = "Update Student";
    submitBtn().className = "btn btn-warning";
}

// DELETE
function deleteStudent(index) {
    if (confirm("Delete this student?")) {
        students.splice(index, 1);
        saveToStorage();
        displayStudents();
    }
}

// HELPERS
const lastNameEl = () => document.getElementById("lastName");
const firstNameEl = () => document.getElementById("firstName");
const middleNameEl = () => document.getElementById("middleName");
const birthdateEl = () => document.getElementById("birthdate");
const courseEl = () => document.getElementById("course");
const yearLevelEl = () => document.getElementById("yearLevel");
const submitBtn = () => document.getElementById("submitBtn");

displayStudents();
</script>

</body>
</html>
